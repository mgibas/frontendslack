<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-shared-styles.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/paper-fab-transitions/paper-fab-morph.html">

<dom-module id="channels-list">
  <template>
    <style>      
      :host {
        display: block;
        padding: 10px;
      }
      
      paper-fab {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
      }
      
      paper-dialog {
        min-width: 400px;
      }
      
      a {
        color: #444;
        text-decoration: none;
      }
      
    </style>
    
    <firebase-query
        id="query"
        app-name="frontendslack"
        path="channels"
        data="{{channels}}">
    </firebase-query>
    <firebase-document id="fbNewChannel" app-name="frontendslack" data="{{newChannel}}"></firebase-document>
    
    <paper-listbox attr-for-selected="key" selected="{{selectedChannel}}">
      <template is="dom-repeat" items="{{channels}}">
        <paper-item item="item" key$="{{item.$key}}" on-tap="_handleTap">{{item.name}}</paper-item>
      </template>
    </paper-listbox> 
    
    <paper-fab-morph id="addDialog" is-overlay-content>
      <paper-fab icon="add" class="dropdown-trigger"></paper-fab>
      <paper-dialog class="dropdown-content">
        <paper-input label="channel name" value="{{newChannel.name}}"></paper-input>
        <div class="buttons">
          <paper-button dialog-dismiss>Close</paper-button>
          <paper-button on-tap="_createChannel" disabled="[[creatingChannel]]" dialog-dismiss>Save</paper-button>
        </div>
      </paper-dialog>
    </paper-fab-morph>
  </template>

  <script>
    (() => {
      class ChannelsList {
        get is() { return 'channels-list'; }
        
        get properties(){
          return {
            selectedChannel:{
              type: String,
              notify:true
            }
          };
        }
        
        _handleTap(){
          this.fire('channel-selected');
        }
        
        _createChannel() {
          this.creatingChannel = true;
          this.$.fbNewChannel.save('/channels')
            .then(()=> {
             this.$.fbNewChannel.reset();
             this.newChannel = {};
             this.$.addDialog.close();
             this.creatingChannel = false;
            });
        }
  
      }
      Polymer(ChannelsList);
    })();

  </script>

</dom-module>
